# 課題

## 使用言語: c++
## テスト環境

- OS: `MacOS Big Sur` version `11.6`
- コンパイラ: `clang` version `13.0.0` 

## ファイル内容

- `main.cpp` : プログラムファイル (課題1 ~ 4まで)
- `data/test.csv` : テスト用のログファイル
- `output`: 実行結果のディレクトリ. ファイル名に課題番号とパラメータを記述

## コンパイル
```
g++ main.cpp -o main --std=c++11
```

## 実行

実行時のオプション`--taskn`によって課題nの解答を出力します.

### 課題1
```
./main -i data/test.csv --task1
```

### 課題2
オプション`-N`で故障とみなすタイムアウト回数を指定します.
```
./main -i data/test.csv --task2 -N 2
```

### 課題3
オプション`-m`と`-t`で過負荷の判定条件を指定します.
```
./main -i data/test.csv --task3 -m 2 -t 1.5
```

### 課題4
オプション`-N`で故障とみなすタイムアウト回数を指定します.
```
./main -i data/test.csv --task4 -N 2
```

### 結果の確認

ディレクトリ`output`以下に各課題, 各パラメータのテスト結果があります. 結果は以下のような形式になっています.

```
Address:WWW.XXX.YYY.ZZZ
    status: YYYY/MM/DD h:m:s(開始) -- YYYY/MM/DD h:m:s(終了) (その他の情報)
    status: YYYY/MM/DD h:m:s(開始) -- YYYY/MM/DD h:m:s(終了) (その他の情報)
    status: YYYY/MM/DD h:m:s(開始) -- YYYY/MM/DD h:m:s(終了) (その他の情報)
    .
    .
    .
Address:WWW.XXX.YYY.ZZZ
    status: YYYY/MM/DD h:m:s(開始) -- YYYY/MM/DD h:m:s(終了) (その他の情報)
    .
    .
    .
```
- statusは故障downと過負荷overloadの2種類です. 
- 課題1, 2, 3 はAddress部がサーバーのアドレス, 課題4はサブネットのアドレスとなります.
- 故障や過負荷からの回復が確認できない場合, 終了時刻は出力されません.


## プログラム説明

課題1から課題4まですべて`main.cpp`に記述しました. 大まかな処理の流れとしては以下のようになっています.

1. ログファイルを読み込み, サーバー(アドレス)ごとに時刻と応答時間を格納
2. (課題4) 同じサブネットに属するサーバーのidをまとめる
3. それぞれのサーバーに対して, レスポンスと順に確認し, 故障や過負荷を検出
4. (課題4) サブネットごとにサーバー故障を検出し, その情報をもとにスイッチの故障を検出


## その他詳細
課題で指定されていない詳細については以下のように仮定しました.

### 課題全般
- サーバーが故障, 過負荷状態から復旧することなくログを読み終えた場合も通常の故障, 過負荷と同様に出力します. その場合, 終了時刻は出力されません. また, この際故障が確定していないもの(タイムアウトがN回未満)のものは出力しません.
- サーバーの故障. 過負荷が複数回検出された場合すべて出力します.
- ログの確認日時が同時刻になることは無いと仮定します. 
- ログ内で時刻が前後することは無いと仮定します.

### 負荷計算について
- 応答がない場合回は除外します. つまり, 応答があったものうちで直近mの平均を計算します.
- 応答ありのログが直近でm個未満の場合, 過負荷でないと判定します.
